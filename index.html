<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <base href="/monkeynad.fun/">
    <link rel="icon" href="favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="title" content="ApeEscape Remastered" />
    <meta name="description" content="ApeEscape BananaFarm" />
    <meta name="keywords" content="ApeEscape, BNB, DAPP, BananaFarm" />
    <link rel="apple-touch-icon" href="logo.png" />
    <meta property="og:image" content="logo.png" />
    <meta property="og:image:secure_url" content="logo.png" />
    <meta property="og:image:alt" content="ApeEscape Bananafarm" />
    <meta property="og:title" content="ApeEscape Bananafarm" />
    <meta property="og:description" content="BananaFarm" />
    <link rel="manifest" href="manifest.json" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      @font-face {
        font-family: "PoseyTextured";
        src: url("poseytextured.woff2") format("woff2");
      }
      body {
        font-family: "PoseyTextured", Montserrat, sans-serif;
      }
      .wallet-container {
        text-align: center;
        margin-top: 20px;
      }
      #connect-btn {
        padding: 10px 20px;
        font-size: 16px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }
      #wallet-address {
        margin-top: 10px;
        font-size: 14px;
        color: #333;
      }
    </style>
    <title>ApeEscape Bananafarm</title>
  </head>

  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>

    <div id="root"></div>

    <!-- Wallet Connect Section -->
    <div class="wallet-container">
      <button id="connect-btn">Connect Wallet</button>
      <p id="wallet-address"></p>
    </div>

    <!-- JavaScript for Wallet Connection -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        console.log("âœ… Page loaded. Checking wallet connection...");
        
        // Check if user was already connected
        checkExistingWallet();

        // Bind connect button to wallet detection
        const connectBtn = document.getElementById("connect-btn");
        if (connectBtn) {
          connectBtn.addEventListener("click", detectWallet);
        } else {
          console.error("âŒ Connect button not found!");
        }
      });

      async function detectWallet() {
        console.log("ðŸ” Detecting wallets...");
        let provider = null;

        // Prioritize SafePal, then MetaMask
        if (window.safepalProvider) {
          provider = window.safepalProvider;
        } else if (window.ethereum) {
          provider = window.ethereum;
        }

        if (!provider) {
          console.error("âŒ No supported wallet found.");
          alert("No supported wallet found. Please install SafePal or MetaMask.");
          return;
        }

        try {
          console.log("ðŸ”„ Requesting wallet connection...");
          const accounts = await provider.request({ method: "eth_requestAccounts" });

          if (accounts.length > 0) {
            console.log("âœ… Wallet connected:", accounts[0]);
            localStorage.setItem("wallet_connected", "true");
            localStorage.setItem("wallet_address", accounts[0]);

            // Update button text and wallet address
            updateButtonState(accounts[0]);

            // ðŸ”„ Auto-refresh after successful connection
            setTimeout(() => {
              location.reload();
            }, 500);
          }
        } catch (error) {
          console.error("âš ï¸ Wallet connection failed:", error);
        }
      }

      function checkExistingWallet() {
        const savedWallet = localStorage.getItem("wallet_connected");
        const savedAddress = localStorage.getItem("wallet_address");

        if (savedWallet && savedAddress) {
          console.log("ðŸ”„ Restoring wallet:", savedWallet);
          updateButtonState(savedAddress);
        }
      }

      function updateButtonState(walletAddress) {
        const connectBtn = document.getElementById("connect-btn");
        if (connectBtn) {
          connectBtn.innerText = "Disconnect";
          connectBtn.onclick = disconnectWallet;
        }

        const walletAddressDisplay = document.getElementById("wallet-address");
        if (walletAddressDisplay) {
          walletAddressDisplay.innerText = `Connected: ${walletAddress}`;
        }
      }

      function disconnectWallet() {
        console.log("ðŸ”´ Disconnecting wallet...");
        localStorage.removeItem("wallet_connected");
        localStorage.removeItem("wallet_address");

        // Reset button state
        const connectBtn = document.getElementById("connect-btn");
        if (connectBtn) {
          connectBtn.innerText = "Connect Wallet";
          connectBtn.onclick = detectWallet;
        }

        // Clear displayed wallet address
        const walletAddressDisplay = document.getElementById("wallet-address");
        if (walletAddressDisplay) {
          walletAddressDisplay.innerText = "";
        }

        // ðŸ”„ Force refresh to fully reset connection state
        setTimeout(() => {
          location.reload();
        }, 500);
      }
    </script>

    <!-- Load the main JavaScript file -->
    <script defer src="static/js/main.41b81be2.js"></script>
    <link href="static/css/main.e07792ef.css" rel="stylesheet" />
  </body>
</html>
